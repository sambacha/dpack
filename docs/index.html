<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@etherpacks/dpack</title><meta name="description" content="Documentation for @etherpacks/dpack"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@etherpacks/dpack</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>@etherpacks/dpack</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#dpack" id="dpack" style="color: inherit; text-decoration: none;">
  <h1><code>dpack</code></h1>
</a>
<center>
  <img alt="a picture of dpack-1, the friendly mascot for the dpack-1 format"
       src="https://x.mypinata.cloud/ipfs/QmZ9RVSRkTsqVg4CHdHfQQxWXmHWrWwoF3Nd2t5E6cz6fN"
  ></img>
</center>

<p>A dpack is a file with a collection of EVM addresses and artifacts (ABIs).</p>
<p>The most important part of dpack is the <code>dpack-1</code> file format.
It has a simple and final spec that one person can learn in one sitting.
New features will be deferred until the next version, which will be backwards
compatible.</p>
<p>This repo is a lightweight javascript package which lets you</p>
<ul>
<li>assemble dpacks from your deployment info</li>
<li>easily load and instantiate bindings for dapps</li>
</ul>
<p>For the time being, we are distributing dpack via npm:</p>
<p><code>npm i @etherpacks/dpack  # WAIT! Read the next paragraph!</code></p>
<p><strong>WARNING</strong>: Please take a minute to reflect on the nature of the software supply chain.
What good is dpack if you are loading it via npm? Why not just stick the info in a package.json?
There is no &#39;partially secured&#39;, we are either bootstrapped into a secure software supply chain, or not.
If you are using <code>npm</code> as currently architected, you are not bootstrapped. But we have to start somewhere,
so here we are.</p>

<a href="#basic-usage" id="basic-usage" style="color: inherit; text-decoration: none;">
  <h2>Basic Usage</h2>
</a>
<p><code>ipfs daemon</code> must be running. <code>dpack</code> will connect to the default IPFS RPC URL unless one is specified with the environment variable <code>IPFS_RPC_URL</code>.</p>
<p>Loading a dpack:</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">dpack</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;dpack&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">dapp</span><span class="hl-1"> = </span><span class="hl-5">dpack</span><span class="hl-1">.</span><span class="hl-3">load</span><span class="hl-1">(</span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;./pack/weth_ropsten.dpack.json&#39;</span><span class="hl-1">))</span><br/><br/><span class="hl-5">dapp</span><span class="hl-1">.</span><span class="hl-5">_objects</span><span class="hl-1"> </span><span class="hl-6">// all instantiated contract *objects* from this pack</span><br/><span class="hl-5">dapp</span><span class="hl-1">.</span><span class="hl-5">_types</span><span class="hl-1">   </span><span class="hl-6">// all artifacts plus ethers.js &#39;factories&#39;; JS-level objects that deploy new instances of contracts</span><br/><br/><span class="hl-6">// objects are also loaded directly onto the dapp object</span><br/><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-5">dapp</span><span class="hl-1">.</span><span class="hl-5">weth</span><span class="hl-1">.</span><span class="hl-3">transfer</span><span class="hl-1">(...)</span><br/><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-5">dapp</span><span class="hl-1">.</span><span class="hl-5">_objects</span><span class="hl-1">.</span><span class="hl-5">weth</span><span class="hl-1">.</span><span class="hl-3">transfer</span><span class="hl-1">(...)   </span><span class="hl-6">// equivalent, its the same reference</span>
</code></pre>
<p>Putting together a dpack:</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">dpack</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;dpack&#39;</span><span class="hl-1">)</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">pb</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-5">dpack</span><span class="hl-1">.</span><span class="hl-3">PackBuilder</span><span class="hl-1">(</span><span class="hl-4">&#39;kovan&#39;</span><span class="hl-1">)</span><br/><span class="hl-6">// you can also say `const pb = dpack.builder()`</span><br/><br/><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-5">pb</span><span class="hl-1">.</span><span class="hl-3">packType</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">typename:</span><span class="hl-1"> </span><span class="hl-4">&#39;Gem&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">artifact:</span><span class="hl-1"> </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;./artifact/sol/Gem.sol/Gem.json&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">})</span><br/><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-5">pb</span><span class="hl-1">.</span><span class="hl-3">packObject</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">typename:</span><span class="hl-1"> </span><span class="hl-4">&#39;GemFab&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">artifact:</span><span class="hl-1"> </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;./artifacts/sol/Gem.sol/Gem.json&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-5">objectname:</span><span class="hl-1"> </span><span class="hl-4">&#39;gemfab&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">address:</span><span class="hl-1"> </span><span class="hl-4">&#39;0x...&#39;</span><br/><span class="hl-1">}, </span><span class="hl-5">alsoAddType</span><span class="hl-1">=</span><span class="hl-0">true</span><span class="hl-1">)  </span><span class="hl-6">// alsoAddType argument defaults to true, adds GemFab+artifact to types</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">pack</span><span class="hl-1"> = </span><span class="hl-7">await</span><span class="hl-1"> </span><span class="hl-5">pb</span><span class="hl-1">.</span><span class="hl-3">build</span><span class="hl-1">();</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">pretty</span><span class="hl-1"> = </span><span class="hl-8">JSON</span><span class="hl-1">.</span><span class="hl-3">stringify</span><span class="hl-1">(</span><span class="hl-5">pack</span><span class="hl-1">, </span><span class="hl-0">null</span><span class="hl-1">, </span><span class="hl-9">2</span><span class="hl-1">);</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-3">log</span><span class="hl-1">(</span><span class="hl-5">pretty</span><span class="hl-1">);</span>
</code></pre>

<a href="#dpack-format-description" id="dpack-format-description" style="color: inherit; text-decoration: none;">
  <h2><code>dpack</code> format description</h2>
</a>
<p>A dpack is a JSON file with these fields:</p>
<pre><code><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-4">&quot;format&quot;</span><span class="hl-1">: </span><span class="hl-4">&quot;dpack-1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">&quot;network&quot;</span><span class="hl-1"> </span><span class="hl-4">&quot;ethereum&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">&quot;types&quot;</span><span class="hl-1">: { ... },</span><br/><span class="hl-1">  </span><span class="hl-4">&quot;objects&quot;</span><span class="hl-1">: { ... }</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#format" id="format" style="color: inherit; text-decoration: none;">
  <h3>format</h3>
</a>
<p><code>format</code> is currently <code>dpack-1</code></p>

<a href="#network" id="network" style="color: inherit; text-decoration: none;">
  <h3>network</h3>
</a>
<p><code>network</code> is the name of the network on which the objects in this dpack are deployed. Future formats will support multi-network packs.</p>

<a href="#types" id="types" style="color: inherit; text-decoration: none;">
  <h3>types</h3>
</a>
<p><code>types</code> is a collection of named contract types (&quot;classes&quot;). Each object has this form:</p>
<pre><code><span class="hl-4">&quot;MyToken&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">  </span><span class="hl-4">&quot;typename&quot;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-4">&quot;MyToken&quot;</span><br/><span class="hl-1">  </span><span class="hl-4">&quot;artifact&quot;</span><span class="hl-1">: {</span><span class="hl-4">&quot;/&quot;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-4">&quot;&lt;CID&gt;&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">}</span>
</code></pre>
<ul>
<li><code>typename</code> is the name of the type (ie, the Solidity class)</li>
<li><code>artifacts</code> is a DAG-JSON link to this type&#39;s &quot;artifacts&quot; json file (output of solc/truffle/hardhat).</li>
</ul>
<p>Note that &#39;typename&#39; is redundant with key used to name this type in this pack.
Typenames are mixedcase alphanumeric and underscores, but must start with an uppercase alphabetic.</p>

<a href="#objects" id="objects" style="color: inherit; text-decoration: none;">
  <h3>objects</h3>
</a>
<p><code>objects</code> is a collection of named EVM contract instances.
Each object descriptor stores both object information (object name and address)
as well as its type information (artifacts and typename).</p>
<p>If an object&#39;s typename matches one of the types declared in this same scope (the same dpack),
or if multiple objects have the same typename, then the artifacts must also match. This means
some typenames and CID&#39;s will be recorded redundantly in the pack.</p>
<pre><code><span class="hl-4">&quot;mytoken&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">  </span><span class="hl-4">&quot;objectname&quot;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-4">&quot;mytoken&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">&quot;address&quot;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-4">&quot;&lt;ETH address&gt;&quot;</span><br/><span class="hl-1">  </span><span class="hl-4">&quot;typename&quot;</span><span class="hl-1">: </span><span class="hl-4">&quot;MyToken&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">&quot;artifact&quot;</span><span class="hl-5">:</span><span class="hl-1"> {</span><span class="hl-4">&quot;/&quot;</span><span class="hl-5">:</span><span class="hl-1"> </span><span class="hl-4">&quot;&lt;CID&gt;&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">}</span>
</code></pre>
<ul>
<li><code>objectname</code> is the name of the object (a deployed &#39;contract&#39; with a specific address)</li>
<li><code>address</code> is the address of the object</li>
<li><code>typename</code> is the name of the type (ie, the Solidity class).</li>
<li><code>artifact</code> is a DAG-JSON link to this object&#39;s type&#39;s &quot;artifacts&quot; json file (output of solc/truffle/hardhat)</li>
</ul>
<p>Note that &#39;objectname&#39; is redundant with key used to name this object in this pack.
Typenames are mixedcase alphanumeric and underscores, but must start with an uppercase alphabetic.
Objectnames are mixedcase alphanumeric and underscores, but must start with a lowercase alphabetic.</p>

<a href="#discussion" id="discussion" style="color: inherit; text-decoration: none;">
  <h2>Discussion</h2>
</a>
<p>Much of the Ethereum toolchain ecosystem confuses types and objects just because we call both &quot;contracts&quot;.</p>
<p>The prime example of this is the keyword <code>contract</code> in solidity referring to a contract <em>class</em>.</p>
<p>The dpack format makes a clear distinction and is very explicit. You cannot name an object the same as a type.</p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li><li class=" tsd-kind-namespace"><a href="modules/Builder.html">Builder</a></li><li class=" tsd-kind-namespace"><a href="modules/IpfsUtil.html">Ipfs<wbr/>Util</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-reference"><a href="modules.html#isCid" class="tsd-kind-icon">is<wbr/>Cid</a></li><li class="tsd-kind-class"><a href="classes/Dapp.html" class="tsd-kind-icon">Dapp</a></li><li class="tsd-kind-class"><a href="classes/PackBuilder.html" class="tsd-kind-icon">Pack<wbr/>Builder</a></li><li class="tsd-kind-function"><a href="modules.html#builder" class="tsd-kind-icon">builder</a></li><li class="tsd-kind-function"><a href="modules.html#getIpfsJson" class="tsd-kind-icon">get<wbr/>Ipfs<wbr/>Json</a></li><li class="tsd-kind-function"><a href="modules.html#load" class="tsd-kind-icon">load</a></li><li class="tsd-kind-function"><a href="modules.html#putIpfsJson" class="tsd-kind-icon">put<wbr/>Ipfs<wbr/>Json</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li><li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-method tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>